"""
WSGI Configuration for PythonAnywhere

Instructions:
1. Copy this file content
2. In PythonAnywhere Web tab, click on WSGI configuration file
3. Replace all content with this file
4. Update the paths and environment variables below
5. Save and reload web app
"""

import sys
import os

# ============================================
# CONFIGURATION - UPDATE THESE VALUES
# ============================================

# Your PythonAnywhere username
USERNAME = 'yourusername'  # CHANGE THIS!

# Your project path
PROJECT_PATH = f'/home/{USERNAME}/tofa-crm'

# Virtual environment path
VENV_PATH = f'/home/{USERNAME}/tofa-crm/venv'

# ============================================
# PATH SETUP
# ============================================

# Add project directory to Python path
if PROJECT_PATH not in sys.path:
    sys.path.insert(0, PROJECT_PATH)

# ============================================
# ENVIRONMENT VARIABLES
# ============================================

# Database URL (from Supabase or your PostgreSQL)
os.environ['DATABASE_URL'] = 'postgresql://user:password@host:port/database'  # CHANGE THIS!

# JWT Secret Key (generate a secure random string)
os.environ['SECRET_KEY'] = 'your-secret-key-change-this'  # CHANGE THIS!

# JWT Algorithm
os.environ['ALGORITHM'] = 'HS256'

# Token expiration (in minutes)
os.environ['ACCESS_TOKEN_EXPIRE_MINUTES'] = '60'

# ============================================
# VIRTUAL ENVIRONMENT ACTIVATION
# ============================================

activate_this = f'{VENV_PATH}/bin/activate_this.py'
try:
    with open(activate_this) as file_:
        exec(file_.read(), dict(__file__=activate_this))
except FileNotFoundError:
    # If activate_this.py doesn't exist, try alternative method
    activate_script = f'{VENV_PATH}/bin/activate'
    if os.path.exists(activate_script):
        # Add venv to path
        site_packages = f'{VENV_PATH}/lib/python3.10/site-packages'
        if site_packages not in sys.path:
            sys.path.insert(0, site_packages)

# ============================================
# APPLICATION IMPORT
# ============================================

# Change to project directory
os.chdir(PROJECT_PATH)

# Import FastAPI application
from backend.main import app as application

# For debugging (optional - remove in production)
# if __name__ == "__main__":
#     print("WSGI loaded successfully!")
#     print(f"Project path: {PROJECT_PATH}")
#     print(f"Python path: {sys.path}")

